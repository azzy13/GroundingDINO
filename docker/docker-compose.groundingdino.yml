# Docker Compose service definition for GroundingDINO ROS2 node
# Add this service to your existing docker-compose.yml in airsim/release_installer/docker/

version: '3.8'

services:
  groundingdino:
    image: groundingdino_ros:latest
    container_name: groundingdino_${USER:-user}
    networks:
      - ros_network
    environment:
      - ROS_DOMAIN_ID=0
      - ROS_SECURITY_ENABLE=false
      - RMW_IMPLEMENTATION=rmw_cyclonedds_cpp
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=all
    volumes:
      # Model weights (read-only)
      - ${PWD}/../../vlmtest/GroundingDINO/weights:/weights:ro

      # Mission config (read-only)
      - ${PWD}/../release/mission_briefing:/mission_briefing:ro

      # Output directory (read-write)
      - ${PWD}/../release/output:/output:rw

      # Optional: Config overrides
      # - ${PWD}/../release/architecture_demo/config/groundingdino_params.yaml:/app/config/params.yaml:ro
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    depends_on:
      - adk
    restart: unless-stopped
    command: >
      ros2 launch groundingdino_ros groundingdino.launch.py
      tracker_type:=bytetrack
      output_visualization:=true

networks:
  ros_network:
    external: true
    name: ros_network_${USER:-user}
